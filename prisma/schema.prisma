generator client {
  provider = "prisma-client"
  output   = "../app/generated/prisma"
}

datasource db {
  provider = "postgresql"
  // url      = .env("DATABASE_URL")
}

model User {
  id              Int          @id @default(autoincrement())
  mobile          String       @unique
  password        String
  firstName       String?
  lastName        String?
  roles           UserRole[]
  teacherClasses  Class[]      @relation("TeacherClasses")
  studentClasses  Class[]      @relation("StudentClasses")
  attendances     Attendance[] @relation("AttendancePresents")
  excusedAbsences Attendance[] @relation("AttendanceExcusedAbsences")

  cityId Int?
  city   City? @relation(fields: [cityId], references: [id])
}

model UserRole {
  id     Int  @id @default(autoincrement())
  role   Role
  userId Int
  user   User @relation(fields: [userId], references: [id])
}

enum Role {
  ADMIN
  CITY_ADMIN
  TEACHER
  STUDENT
}

model Class {
  id         Int          @id @default(autoincrement())
  name       String
  teacher    User         @relation("TeacherClasses", fields: [teacherId], references: [id])
  teacherId  Int
  students   User[]       @relation("StudentClasses")
  attendance Attendance[]
  cityId     Int?
  city       City?         @relation(fields: [cityId], references: [id])
}

model Attendance {
  id              Int      @id @default(autoincrement())
  classId         Int
  class           Class    @relation(fields: [classId], references: [id])
  date            DateTime @default(now())
  presents        User[]   @relation("AttendancePresents")
  excusedAbsences User[]   @relation("AttendanceExcusedAbsences")
}

model City {
  id      Int     @id @default(autoincrement())
  name    String  @unique
  users   User[]
  classes Class[]
}
